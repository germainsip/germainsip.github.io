<!DOCTYPE html>
<html class="no-js" lang="fr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Electron Intro - Mes ressources</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="Cr√©ation d&#39;une app desktop avec electron">
	<meta property="og:title" content="Electron Intro" />
<meta property="og:description" content="Cr√©ation d&#39;une app desktop avec electron" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/cours/electron/electron-intro/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-04-29T09:41:07&#43;02:00" />
<meta property="article:modified_time" content="2021-04-29T09:41:07&#43;02:00" />


	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Electron Intro"/>
<meta name="twitter:description" content="Cr√©ation d&#39;une app desktop avec electron"/>

	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Mes ressources" rel="home">
				<div class="logo__title">Mes ressources</div>
				<div class="logo__tagline">Site de partage de ressources</div>
			</a>
		</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Electron Intro</h1>
			<p class="post__lead">Cr√©ation d&#39;une app desktop avec electron</p>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2021-04-29T09:41:07&#43;02:00">29-04-2021</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/categories/electron/" rel="category">Electron</a>
	</span>
</div></div>
		</header>
		<figure class="post__thumbnail">
			<img src="/img/electron/electronjs.gif" alt="Electron Intro">
		</figure>
<div class="post__toc toc">
	<div class="toc__title">Sommaire</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#larchitecture-delectron">L&rsquo;architecture d&rsquo;electron</a></li>
    <li><a href="#main-et-renderer">Main et Renderer</a></li>
    <li><a href="#communication-entre-main-et-renderer">Communication entre <code>main</code> et <code>renderer</code></a></li>
    <li><a href="#les-t√¢ches-de-fond">Les T√¢ches de fond</a></li>
    <li><a href="#vu-de-plus-haut">Vu de plus haut</a></li>
    <li><a href="#cr√©ons-une-application-electron">Cr√©ons une application Electron</a></li>
  </ul>
</nav>
	</div>
</div>
<div class="content post__content clearfix">
			<h1 id="electron">Electron</h1>
<h2 id="larchitecture-delectron">L&rsquo;architecture d&rsquo;electron</h2>
<p>Electron utilise plusieurs processus pour g√©rer les √©tats de l&rsquo;application et l&rsquo;interface utilisateur. Le processus principal <code>main</code> g√®re les √©tats de l&rsquo;application pendant que le <code>renderer</code> s&rsquo;occupe de l&rsquo;interface utilisateur.</p>
<p>Au d√©marrage d&rsquo;une application Electron un processus <code>main</code> est cr√©√©. On ne peut en avoir qu&rsquo;un seul. Ce <code>main</code> a acc√®s aux api de <strong>Node.js</strong> mais pas celles de <strong>chromium</strong>. De ce fait, on peut utiliser les API node comme <code>fs.writeFile()</code>ou <code>require()</code> mais pas  <code>document</code> ou encore <code>window.addEventListener()</code>.</p>
<p>Dans l&rsquo;id√©e, Electron peut √™tre vu comme un navigateur. Le <code>main</code> est le navigateur et le <code>renderer</code> un onglet du navigateur. Du coup, le <code>main</code> peut ouvrir autant d&rsquo;onglet qu&rsquo;il a besoin. Ici on appellera, pour <strong>Electron</strong>, un onglet une fen√™tre (<code>window</code>) puisque nous cr√©ons une application desktop.</p>
<p><img src="/img/electron/fen-base.png" alt="fen-base"></p>
<p>A partir du <code>main.js</code> (processus <code>main</code>) on cr√©e un fen√™tre en instanciant <a href="https://www.electronjs.org/docs/api/browser-window"><code>BrowserWindow</code></a> accessible √† partir du package <code>electron</code>.</p>
<p>Cette fen√™tre <code>win</code> est vide et on y charge une page web (HTML) avec <code>win.loadFile(path)</code> ou <code>win.loadURL(url)</code> (distant). Avec cet appel <strong>Electron</strong> cr√©e un processus de rendu <code>renderer</code>et affiche la page.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">//main.js
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">BrowserWindow</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;electron&#39;</span>)

<span style="color:#75715e">//Cr√©ation d&#39;une fen√™tre
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">win</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">BrowserWindow</span>({
    <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">500</span>,
    <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">200</span>
  })

  <span style="color:#a6e22e">win</span>.<span style="color:#a6e22e">loadFile</span>(<span style="color:#e6db74">&#39;index.html&#39;</span>)
</code></pre></div><p>Le <code>main</code> orchestre l&rsquo;application mais ne peut pas cr√©er d&rsquo;interface utilisateur. Il doit cr√©er un <code>renderer</code>√† partir de l&rsquo;interface <code>BrowserWindow</code>.</p>
<blockquote>
<p><code>BrowserWidow</code> est une interface de haut-niveau pour rendre et controller la partie web mais ne peut pas rendre par elle m√™me de page web. L&rsquo;interface <code>webContents</code> est une api de bas niveau qui est responsable du rendu et du contr√¥le de la page en utilisant <strong>Chromium</strong>.</p>
</blockquote>
<p>Le processus de rendu (<code>renderer</code>) est un processus syst√®me (OS) associ√© avec l&rsquo;interface <code>webContent</code>. On peut acc√©der √† cette interface avec l&rsquo;interface <code>BrowserWindow</code> en utilisant la propri√©t√© <code>win.webContents</code>. Pour conna√Ætre l&rsquo;adresse OS PID, on utilise <code>win.webContents.getOSProcessId()</code> et pour avoir le PID du renderer Chromium <code>win.webContents.getProcessId()</code>.</p>
<blockquote>
<p>On pourrai croire qu&rsquo;il n&rsquo;a qu&rsquo;un processus de rendu par fen√™tre, mais ce n&rsquo;est pas toujours le cas. Le renderer est cr√©√© au chargement d&rsquo;une page dans une fen√™tre. Une fen√™tre peut avoir d&rsquo;autres renderer via un <code>&lt;webview&gt;</code>ou en ajoutant un <code>BrowserView</code> √† une fen√™tre existante.</p>
</blockquote>
<h2 id="main-et-renderer">Main et Renderer</h2>
<p>Le processus principal (<code>main</code>) s&rsquo;occupe de l&rsquo;application et le processus de rendu (<code>renderer</code>) contr√¥le l&rsquo;UI.</p>
<p>Cependant le renderer n&rsquo;a pas acc√®s √† beaucoup de choses. Le main a acc√®s √† l&rsquo;api node par d√©faut. On peut, si on le souhaite, √† la cr√©ation d&rsquo;une fen√™tre avec <code>new BrowserWindow(options)</code> autoriser le renderer a utiliser l&rsquo;API Node en ajoutant <code>nodeIntegration: true</code>. Sa valeur est <code>false</code> par d√©faut pour des raisons de s√©curit√©. On pourrai par exemple passer ce param√®tre √† <code>true</code> si on a besoin de <code>fs.writeFile()</code> ou <code>require()</code> √† partir du renderer.</p>
<blockquote>
<p>Le fait d&rsquo;activer cet int√©gration de Node n&rsquo;est pas recommand√©e car on peut donner acc√®s au syst√®mes √† des logiciels malicieux.</p>
</blockquote>
<p>De m√™me, on ne peut pas cr√©er une nouvelle fen√™tre √† partir d&rsquo;une fen√™tre. Cela doit se faire √† partir du <code>main</code>.</p>
<blockquote>
<p><code>window.open()</code> peut quand m√™me cr√©er un affichage mais avec des fonctionnalit√©s limit√©s.</p>
</blockquote>
<p>Autre chose, tout ce qui est relatif √† l&rsquo;API syst√®me est uniquement accessible depuis le <code>main</code> (ex: <code>dialog</code>).
Certains sont quand m√™me accessibles aux deux comme vous pouvez le voir dans ce tableau r√©capitulatif.</p>
<table>
<thead>
<tr>
<th>Main</th>
<th>Renderer</th>
<th>Commun</th>
</tr>
</thead>
<tbody>
<tr>
<td>app</td>
<td>desktopCapturer</td>
<td>clipboard</td>
</tr>
<tr>
<td>autoUpdater</td>
<td>ipcRenderer</td>
<td>crashReporter</td>
</tr>
<tr>
<td>BrowserView</td>
<td>remote</td>
<td>nativeImage</td>
</tr>
<tr>
<td>BrowserWindow</td>
<td>webFrame</td>
<td>shell</td>
</tr>
<tr>
<td>contentTracing</td>
<td></td>
<td></td>
</tr>
<tr>
<td>dialog</td>
<td></td>
<td></td>
</tr>
<tr>
<td>globalShortcut</td>
<td></td>
<td></td>
</tr>
<tr>
<td>inAppPurchase</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ipcMain</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Menu</td>
<td></td>
<td></td>
</tr>
<tr>
<td>MenuItem</td>
<td></td>
<td></td>
</tr>
<tr>
<td>net</td>
<td></td>
<td></td>
</tr>
<tr>
<td>netLog</td>
<td></td>
<td></td>
</tr>
<tr>
<td>nativeTheme</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Notification</td>
<td></td>
<td></td>
</tr>
<tr>
<td>powerMonitor</td>
<td></td>
<td></td>
</tr>
<tr>
<td>powerSaveBlocker</td>
<td></td>
<td></td>
</tr>
<tr>
<td>protocol</td>
<td></td>
<td></td>
</tr>
<tr>
<td>screen</td>
<td></td>
<td></td>
</tr>
<tr>
<td>session</td>
<td></td>
<td></td>
</tr>
<tr>
<td>systemPreferences</td>
<td></td>
<td></td>
</tr>
<tr>
<td>TouchBar</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Tray</td>
<td></td>
<td></td>
</tr>
<tr>
<td>webContents</td>
<td></td>
<td></td>
</tr>
<tr>
<td>webFrameMain</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="communication-entre-main-et-renderer">Communication entre <code>main</code> et <code>renderer</code></h2>
<p>Alors, on fait comment? Par exemple, on voudrait ouvrir une nouvelle fen√™tre avec une balise <code>&lt;button&gt;</code> avec une une image et un contr√¥le du zoom. C&rsquo;est l√† que l&rsquo;IPC va nous √™tre util.
On peut faire communiquer le <code>renderer</code> et le <code>main</code> grace aux module IPC. Le processus <code>main</code> peut acc√©der √† <code>ipcMain</code> et le <code>renderer</code> √† <code>ipcRenderer</code>.</p>
<p>Le <code>ipcMain</code> peut √©couter un √©venement envoy√© par le renderer en utilisant <code>ipcMain.on()</code> ou il peut g√©rer l&rsquo;ex√©cution de la fonction invoqu√©e par le processus de rendu en utilisant <code>ipcMain.handle()</code>. De m√™me, le module <code>ipcRenderer</code> peut envoyer des messages au processus <code>main</code> en utilisant la m√©thode <code>ipcRenderer.send()</code> ou appeler une proc√©dure √† l&rsquo;int√©rieur du processus principal en utilisant la m√©thode <code>ipcRenderer.invoke()</code>.</p>
<p>Un bon exemple du processus principal d√©pendant du processus de rendu serait l&rsquo;√©tat de la connectivit√© r√©seau. Nous pouvons √©couter les √©v√©nements en ligne ou hors ligne dans un navigateur (<a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine/Online_and_offline_events">documentation</a>). Il est donc possible d‚Äôobtenir la connectivit√© r√©seau de l‚Äôappareil de l‚Äôutilisateur dans le processus de rendu, mais nous ne pouvons pas faire de m√™me dans le processus principal. Ainsi, le seul moyen pour le processus principal d&rsquo;obtenir l&rsquo;√©tat de la connectivit√© r√©seau est de demander au processus de rendu. Par cons√©quent, un processus de rendu peut envoyer un message au processus principal chaque fois que ce statut change (en utilisant les modules ipcMain et ipcRenderer).
Si vous souhaitez communiquer entre deux processus de rendu, vous devez utiliser le processus principal comme pont ou si vous avez acc√®s √† l&rsquo;interface <code>webContents</code> d&rsquo;un processus de rendu, vous pouvez utiliser la m√©thode <code>webContents.send()</code> pour envoyer un message √† un autre processus de rendu et utilisez la m√©thode <code>ipcRenderer.on()</code> pour √©couter ce message.</p>
<h2 id="les-t√¢ches-de-fond">Les T√¢ches de fond</h2>
<p>Si vous souhaitez effectuer une t√¢che gourmande en ressources processeur, vous ne voudriez pas ex√©cuter le code JavaScript de longue dur√©e dans un processus de rendu qui bloquerait l&rsquo;interface utilisateur et la laisserait morte pendant quelques secondes ou minutes. Cependant, si vous le faites, disons par accident, les autres fen√™tres ne seront pas affect√©es car elles s&rsquo;ex√©cutent dans des processus de rendu distincts.</p>
<p>Mais encore, bloquer l‚Äôinterface utilisateur n‚Äôest pas bon car c‚Äôest mauvais pour l‚Äôexp√©rience utilisateur. √Ä quoi sert votre application si l&rsquo;utilisateur ne peut pas interagir avec l&rsquo;interface utilisateur de l&rsquo;application? Vous diriez, utilisons les processus principaux, car ils ne sont pas li√©s au processus de rendu, mais malheureusement, le blocage du processus principal laisserait votre application (et toutes ses fen√™tres) morte √©galement.</p>
<p>Pour ex√©cuter des t√¢ches en arri√®re-plan, nous n&rsquo;avons pas besoin d&rsquo;inventer la roue. Nous avons d√©j√† quelques trucs dans nos manches. Nous pouvons utiliser l&rsquo;API <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers">WebWorker</a> de JavaScript s&rsquo;ex√©cutant √† l&rsquo;int√©rieur du processus de rendu pour d√©marrer une t√¢che en arri√®re-plan. Nous pourrions √©galement utiliser le module int√©gr√© <a href="https://nodejs.org/api/worker_threads.html">worker_threads</a> de Node.js pour d√©marrer un thread de travail comme un thread <code>WebWorker</code>.
Certaines personnes peuvent sugg√©rer d&rsquo;utiliser une fen√™tre transparente sans cadre que les utilisateurs ne peuvent pas voir pour effectuer des t√¢ches en arri√®re-plan et gourmandes en ressources processeur. Voici un <a href="https://www.geeksforgeeks.org/frameless-window-in-electronjs/">article</a> qui d√©crit exactement cela. Cependant, nous devrions √©viter d&rsquo;utiliser de telles astuces lorsque nous avons de meilleures fa√ßons de faire les choses.
Un <code>WebWorker</code> n&rsquo;a pas automatiquement acc√®s √† l&rsquo;API Node.js. Nous devons d√©finir la propri√©t√© <code>options.webPreferences.nodeIntegrationInWorker</code> sur true lors de la cr√©ation d&rsquo;un objet <code>BrowswerWindow</code>. Cette propri√©t√© fonctionne quelle que soit la propri√©t√© <code>nodeIntegration</code>.</p>
<h2 id="vu-de-plus-haut">Vu de plus haut</h2>
<p>Ce dont nous avons discut√© jusqu‚Äô√† pr√©sent n‚Äôest qu‚Äôun aper√ßu de l‚Äôarchitecture d‚ÄôElectron. Si vous voulez creuser plus profond√©ment, vous voudrez peut-√™tre lire ceci. R√©sumons ce dont nous avons discut√© jusqu&rsquo;√† pr√©sent avec un diagramme simplifi√©.</p>
<p><img src="/img/electron/diag2-2.png" alt="diag2"></p>
<!-- TODO: image √† refaire -->
<p>L&rsquo;ensemble du processus et de l&rsquo;architecture de communication d&rsquo;Electron est bas√© sur l&rsquo;architecture de Chromium. Par exemple, le concept de processus principal et de rendu, ainsi que le m√©canisme de communication IPC sont d√©riv√©s de l‚Äôarchitecture de Chromium. Pour en savoir plus sur le fonctionnement de Chromium sous le capot, lisez cette <a href="https://www.chromium.org/developers/design-documents/multi-process-architecture">documentation</a> sur chromium.org.</p>
<h2 id="cr√©ons-une-application-electron">Cr√©ons une application Electron</h2>
<p>Cr√©ons une application desktop simple qui affiche &ldquo;Je d√©bute avec Electron!&rdquo; dans une fen√™tre et un bouton qui ouvre une fen√™tre avec une image al√©atoire d&rsquo;Internet.</p>
<p>Cr√©ons un r√©pertoire de projet. Pour moi, le nom du r√©pertoire du projet est <code>electron-un</code>. La structure du projet ressemblera √† celle ci-dessous, mais nous passerons en revue chacun de ces fichiers un par un.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">electron-un/
‚îú‚îÄ‚îÄ main.js
‚îú‚îÄ‚îÄ hello.html
‚îú‚îÄ‚îÄ image.html
‚îú‚îÄ‚îÄ img.jpeg
‚îú‚îÄ‚îÄ package-lock.json
‚îî‚îÄ‚îÄ package.json
</code></pre></div><p>D√©sormais, pour cr√©er des applications desktop √† l&rsquo;aide d&rsquo;Electron, nous n&rsquo;avons pas besoin d&rsquo;une configuration sophistiqu√©e ni d&rsquo;installer une application. Nous avons juste besoin du package electron que nous pouvons installer √† l&rsquo;aide de la commande <code>npm install</code> ou <code>yarn add</code>. Alors initialisons notre projet avec <code>npm init</code>. Et ensuite ajoutons electron.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">npm init -y
npm install --save-dev electron
npx electron --version
 v11.1.1
</code></pre></div><blockquote>
<p>le <code>-y</code>  oblige npm √† r√©pondre aux questions par lui m√™me.</p>
</blockquote>
<p>Voici maintenant un point important que vous ne devez jamais oublier. Le point d&rsquo;entr√©e d&rsquo;une application Electron est un fichier JavaScript. Ce fichier JavaScript s&rsquo;ex√©cute dans le processus principal et ouvrira les fen√™tres d&rsquo;application comme indiqu√© pr√©c√©demment. Cr√©ons donc le fichier <code>main.js</code> dans le projet.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">//main.js
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">app</span>, <span style="color:#a6e22e">BrowserWindow</span>, <span style="color:#a6e22e">ipcMain</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>( <span style="color:#e6db74">&#39;electron&#39;</span> );

<span style="color:#75715e">// ouvrir une fen√™tre
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">openWindow</span> <span style="color:#f92672">=</span> ( <span style="color:#a6e22e">type</span> ) =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">win</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">BrowserWindow</span>( {
        <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">400</span>,
        <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">300</span>,
    } );

    <span style="color:#66d9ef">if</span>( <span style="color:#a6e22e">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;image&#39;</span> ) {
        <span style="color:#a6e22e">win</span>.<span style="color:#a6e22e">loadFile</span>( <span style="color:#e6db74">&#39;./image.html&#39;</span> ); <span style="color:#75715e">// fen√™tre image
</span><span style="color:#75715e"></span>    } <span style="color:#66d9ef">else</span> {
        <span style="color:#a6e22e">win</span>.<span style="color:#a6e22e">loadFile</span>( <span style="color:#e6db74">&#39;./hello.html&#39;</span> ); <span style="color:#75715e">// fen√™tre par d√©faut
</span><span style="color:#75715e"></span>    }
}

<span style="color:#75715e">// quand l&#39;application est pr√™te on cr√©e la fen√™tre
</span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">on</span>( <span style="color:#e6db74">&#39;ready&#39;</span>, () =&gt; {
    <span style="color:#a6e22e">openWindow</span>();
} );

<span style="color:#75715e">// si toutes le fen√™tre sont ferm√©es on quite
</span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">on</span>( <span style="color:#e6db74">&#39;window-all-closed&#39;</span>, () =&gt; {
    <span style="color:#66d9ef">if</span>( <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">platform</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;darwin&#39;</span> ) {
        <span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">quit</span>(); <span style="color:#75715e">// exit
</span><span style="color:#75715e"></span>    }
} );

<span style="color:#75715e">// quand l&#39;appli est active on ouvre une fen√™tre
</span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">on</span>( <span style="color:#e6db74">&#39;activate&#39;</span>, () =&gt; {
    <span style="color:#66d9ef">if</span>( <span style="color:#a6e22e">BrowserWindow</span>.<span style="color:#a6e22e">getAllWindows</span>().<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span> ) {
        <span style="color:#a6e22e">openWindow</span>();
    }
} );

<span style="color:#75715e">// √† l&#39;√©coute du message de l&#39;appli
</span><span style="color:#75715e"></span><span style="color:#a6e22e">ipcMain</span>.<span style="color:#a6e22e">on</span>( <span style="color:#e6db74">&#39;app:display-image&#39;</span>, () =&gt; {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>( <span style="color:#e6db74">&#39;[message received]&#39;</span>, <span style="color:#e6db74">&#39;app:display-image&#39;</span> );
    <span style="color:#a6e22e">openWindow</span>( <span style="color:#e6db74">&#39;image&#39;</span> );
} )
</code></pre></div><p>Voyons ce que nous faisons dans ce fichier. Tout d&rsquo;abord, nous importons les modules <code>app</code>, <code>BrowserWindow</code> et <code>ipcMain</code> √† partir du package <code>electron</code>. Nous avons d√©j√† discut√© des modules <code>BrowserWindow</code> et <code>ipcMain</code>, alors laissons cela de c√¥t√© un instant et concentrons-nous sur le module <code>app</code>.</p>
<p>Le module <code>app</code> est une interface pour contr√¥ler le cycle de vie de l&rsquo;application. Si nous voyons la table d&rsquo;accessibilit√© du module, ce module n&rsquo;est disponible que pour le processus principal. Ce module nous donne la possibilit√© d&rsquo;√©couter les √©v√©nements du cycle de vie de l&rsquo;application, d&rsquo;appeler des m√©thodes pour modifier l&rsquo;√©tat de l&rsquo;application et de lire l&rsquo;√©tat de l&rsquo;application via des propri√©t√©s statiques.
Dans le fichier <code>main.js</code> ci-dessus, nous √©coutons l&rsquo;√©v√©nement <code>ready</code> de l&rsquo;application √† l&rsquo;aide de la m√©thode <code>app.on(event, handler)</code>. Cet √©v√©nement est d√©clench√© une seule fois lorsque Electron a termin√© l&rsquo;initialisation de l&rsquo;application et que les fen√™tres peuvent √™tre cr√©√©es en toute s√©curit√©.</p>
<blockquote>
<p>üí° Au lieu de l&rsquo;approche <code>app.on('ready', handler)</code>, vous pouvez √©galement utiliser la m√©thode <code>app.whenReady()</code> qui renvoie une promesse. Dans le gestionnaire <code>then()</code> de cette promesse, vous pouvez faire ce que nous faisons dans le fichier <code>main.js</code> ci-dessus.</p>
</blockquote>
<p>L&rsquo;√©v√©nement <code>window-all-closed</code> est √©mis lorsque la derni√®re fen√™tre ouverte de l&rsquo;application est ferm√©e. Dans le gestionnaire de cet √©v√©nement, nous devons quitter l&rsquo;application en appelant la m√©thode <code>app.quit()</code> sauf lorsque le syst√®me d&rsquo;exploitation est macOS car il contredit le comportement par d√©faut de macOS.</p>
<blockquote>
<p>üí° La variable de processus provient de Node.js puisque le processus principal a toujours acc√®s aux API Node.js. Par cons√©quent, <code>process.platform</code> donne le nom de la plate-forme sous-jacente (noyau ou OS) sur laquelle Node.js s&rsquo;ex√©cute.</p>
</blockquote>
<p>L&rsquo;√©v√©nement d&rsquo;activation est sp√©cifique √† macOS et il est d√©clench√© lorsque l&rsquo;utilisateur clique sur l&rsquo;ic√¥ne de l&rsquo;application du dock (et √† d&rsquo;autres endroits). √âtant donn√© que la fermeture de toutes les fen√™tres dans macOS ne ferme pas l&rsquo;application (processus principal), nous aurions besoin d&rsquo;ouvrir une fen√™tre (si aucune n&rsquo;est ouverte) lorsque l&rsquo;application est √† nouveau activ√©e.
Lorsque l&rsquo;application est pr√™te, nous appelons la fonction <code>openWindow()</code> qui cr√©e une fen√™tre de taille 600x300 et ouvre le fichier <code>hello.html</code> par d√©faut qui se trouve dans le m√™me r√©pertoire que le <code>main.js</code>. Si la valeur de l&rsquo;argument de type est image, cela cr√©era une autre fen√™tre et ouvrira le fichier <code>image.html</code> dans cette fen√™tre.</p>
<p>Puisque nous voulons ouvrir la fen√™tre d&rsquo;image lorsque l&rsquo;utilisateur appuie sur un bouton dans la fen√™tre par d√©faut, nous devons envoyer un message de la fen√™tre par d√©faut (processus de rendu) au <code>main.js</code> (processus principal). Nous √©coutons ce message dans le <code>main.js</code> en utilisant la m√©thode <code>ipcMain.on()</code>. Lorsque <code>main.js</code> re√ßoit l&rsquo;√©v√©nement <code>app: display-image</code>, il ouvrira la fen√™tre d&rsquo;image.</p>
<blockquote>
<p>üí° J&rsquo;utilise le format app: <code>&lt;event-name&gt;</code> pour les √©v√©nements personnalis√©s mais il n&rsquo;y a pas de convention pour nommer les noms d&rsquo;√©v√©nements. Ce devrait √™tre une cha√Æne, c‚Äôest tout.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;fr&#34;</span>&gt;
&lt;<span style="color:#f92672">head</span>&gt;
	&lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
	&lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">http-equiv</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;X-UA-Compatible&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;IE=edge&#34;</span>&gt;
	&lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
	&lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">http-equiv</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Content-Security-Policy&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;script-src &#39;self&#39; &#39;unsafe-inline&#39;;&#34;</span> /&gt;
	&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css&#34;</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span>&gt;
	&lt;<span style="color:#f92672">title</span>&gt;Ma premi√®re appli Electron&lt;/<span style="color:#f92672">title</span>&gt;
&lt;/<span style="color:#f92672">head</span>&gt;

&lt;/<span style="color:#f92672">head</span>&gt;
&lt;<span style="color:#f92672">body</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flex items-center justify-center h-screen&#34;</span>&gt;
	&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-center&#34;</span>&gt;
		&lt;<span style="color:#f92672">h1</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-4xl font-semibold&#34;</span>&gt;Je suis &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;font-bold text-green-400&#34;</span>&gt;Electron&lt;/<span style="color:#f92672">span</span>&gt;!&lt;/<span style="color:#f92672">h1</span>&gt;
		&lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rounded bg-green-400 hover:bg-green-500 hover:shadow text-white mt-5 p-1&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;btn&#39;</span>&gt;Cliquez pour voir une image&lt;/<span style="color:#f92672">button</span>&gt;
	&lt;/<span style="color:#f92672">div</span>&gt;


	&lt;<span style="color:#f92672">script</span>&gt;
		<span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">ipcRenderer</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>( <span style="color:#e6db74">&#39;electron&#39;</span> );

		document.<span style="color:#a6e22e">getElementById</span>( <span style="color:#e6db74">&#39;btn&#39;</span> ).<span style="color:#a6e22e">onclick</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
			<span style="color:#a6e22e">ipcRenderer</span>.<span style="color:#a6e22e">send</span>( <span style="color:#e6db74">&#39;app:display-image&#39;</span> );
			<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>( <span style="color:#e6db74">&#39;[message sent]&#39;</span>, <span style="color:#e6db74">&#39;app:display-image&#39;</span> );
		}
	&lt;/<span style="color:#f92672">script</span>&gt;
&lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><blockquote>
<p>Le style est fait avec tailwindcss et son CDN. Juste un coquetterie de ma part.</p>
</blockquote>
<p>Notre fichier hello.html n&rsquo;est qu&rsquo;une simple page Web HTML. Electron recommande d&rsquo;ajouter un en-t√™te de r√©ponse CSP (Content Security Policy) lors du chargement d&rsquo;une page Web dans une fen√™tre. Lors du chargement d&rsquo;un fichier HTML local, l&rsquo;en-t√™te CSP peut √™tre ajout√© via une balise Meta. Cette √©tape est n√©cessaire pour ajouter une couche de s√©curit√© suppl√©mentaire aux attaques XSS comme d√©crit <a href="https://www.electronjs.org/docs/tutorial/security#6-define-a-content-security-policy">ici</a></p>
<p>L&rsquo;√©l√©ment <code>&lt;title&gt;</code> sp√©cifie le titre du document et Electron utilise cette valeur pour le titre de la fen√™tre que nous verrons dans une minute. Vous pouvez √©galement fournir le titre de la fen√™tre via la propri√©t√© title lors de la cr√©ation d&rsquo;une instance de <code>BrowserWindow</code>.
Dans notre page, nous avons un &ldquo;Je suis Electron!&rdquo; envelopp√© dans un √©l√©ment <code>&lt;h1&gt;</code> et un bouton avec l&rsquo;ID <code>#btn</code>. L&rsquo;√©l√©ment <code>&lt;script&gt;</code> a du JavaScript qui semble un peu diff√©rent du JavaScript normal que nous utilisons dans le navigateur.</p>
<p>Comme indiqu√© pr√©c√©demment, le processus de rendu a √©galement acc√®s aux API Node.js, ce qui signifie que tout JavaScript s&rsquo;ex√©cutant dans une fen√™tre a √©galement acc√®s √† ces API. C&rsquo;est pourquoi nous pouvons utiliser la fonction require de Node dans l&rsquo;√©l√©ment <code>&lt;script&gt;</code>. La m√™me r√®gle s&rsquo;applique si nous importons un fichier JavaScript externe √† l&rsquo;aide de l&rsquo;√©l√©ment <code>&lt;script src = &quot;path-to-file.js&quot;&gt;</code>.
Dans ce JavaScript, nous importons le module <code>ipcRenderer</code> du package electron pour envoyer le message <code>app: display-image</code> au processus principal lorsque l&rsquo;utilisateur appuie sur le bouton <strong>Cliquez pour voir une image</strong>. Vous pouvez √©galement acc√©der aux modules Node int√©gr√©s tels que <code>fs</code> ou <code>path</code> ainsi qu&rsquo;√† des variables globales telles que <code>process</code> et autres.</p>
<p>D√©marrons notre application Electron. Pour d√©marrer l&rsquo;application Electron, nous devons utiliser la commande <code>electron [options] &lt;path&gt;</code>. Cette commande est fournie par le package <code>electron</code>. Ici path est le chemin de <code>main.js</code> ou un r√©pertoire contenant <code>index.js</code> (qui serait le point d&rsquo;entr√©e) ou un r√©pertoire contenant <code>package.json</code>. Ce <code>package.json</code> doit avoir le chemin du point d&rsquo;entr√©e (fichier JavaScript) sp√©cifi√© par le champ <code>main</code>.
Dans notre cas, nous ex√©cuterons la commande <code>electron .</code> √† partir du r√©pertoire du projet. Puisque nous avons le <code>package.json</code> dans ce r√©pertoire, nous devons sp√©cifier le chemin de <code>main.js</code> qui est le point d&rsquo;entr√©e de notre application via le champ <code>main</code> du <code>package.json</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;exemple&#34;</span>,
  <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;1.0.0&#34;</span>,
  <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;un simple exemple&#34;</span>,
  <span style="color:#f92672">&#34;main&#34;</span>: <span style="color:#e6db74">&#34;main.js&#34;</span>, 
  <span style="color:#f92672">&#34;author&#34;</span>: <span style="color:#e6db74">&#34;Germain SIPIERE&#34;</span>,
  <span style="color:#f92672">&#34;license&#34;</span>: <span style="color:#e6db74">&#34;MIT&#34;</span>,
  <span style="color:#f92672">&#34;private&#34;</span>: <span style="color:#66d9ef">false</span>,
  <span style="color:#f92672">&#34;scripts&#34;</span>: {
    <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;electron .&#34;</span>
  },
  <span style="color:#f92672">&#34;devDependencies&#34;</span>: {
    <span style="color:#f92672">&#34;electron&#34;</span>: <span style="color:#e6db74">&#34;^12.0.5&#34;</span>
  }
}
</code></pre></div><p>Puisque electron est un package local, nous ne pouvons pas utiliser <code>electron .</code> depuis le terminal. Vous pouvez ex√©cuter <code>npx electron .</code> mais il est plus pratique d&rsquo;ajouter un script dans <code>package.json</code> comme nous l&rsquo;avons fait ci-dessus et d&rsquo;utiliser la commande <code>npm run start</code> pour d√©marrer l&rsquo;application.</p>
<p><img src="/img/electron/electron2.png" alt="fen2"></p>
<p>Lorsque nous utilisons <code>npm run start</code>, Electron ex√©cute le fichier <code>main.js</code> et l&rsquo;√©v√©nement <code>ready</code> est d√©clench√©, ce qui ouvre une fen√™tre avec le fichier <code>hello.html</code> similaire √† celui que vous voyez ci-dessus. Notez le titre de la fen√™tre. Cette commande bloquera le terminal √† partir duquel cette commande a √©t√© ex√©cut√©e et toutes les instructions <code>console.log</code> ex√©cut√©es dans le processus principal (<code>main.js</code>) seront enregistr√©es ici.
Comme j&rsquo;utilise macOS, je vais ouvrir le moniteur d&rsquo;activit√© pour voir quels processus cette application a d√©marr√©.</p>
<p><img src="/img/electron/moniteur.png" alt="moniteur"></p>
<p>Le processus avec le nom Electron est le processus principal. Le processus nomm√© Electron Helper (Renderer) est le processus de rendu. Comme nous n&rsquo;avons qu&rsquo;une seule fen√™tre ouverte, nous n&rsquo;avons qu&rsquo;un seul processus de rendu. Les autres processus ne sont que des processus auxiliaires du processus principal.
Cliquons sur le bouton Cliquer pour ouvrir une photo rendue dans la fen√™tre et voyons ce qui se passe. Eh bien, rien ne se passera. Pour voir le probl√®me, nous devons ouvrir DevTools.</p>
<p>Pour attacher un DevTools √† la fen√™tre actuelle, appuyez sur Cmd + Option + I (macOS) et cela ouvrira le panneau DevTools dans la fen√™tre.</p>
<blockquote>
<p>üí° Le panneau DevTools est techniquement une autre fen√™tre, il lancera donc un autre processus de rendu que vous pouvez voir dans le moniteur d&rsquo;activit√©. Si vous souhaitez ouvrir DevTools par programmation, utilisez <code>win.openDevTools()</code>.</p>
</blockquote>
<p><img src="/img/electron/devtool.png" alt="devtool"></p>
<p>Le JavaScript s&rsquo;ex√©cutant dans cette fen√™tre a lev√© une exception. Il dit que la variable require n&rsquo;existe pas √† la ligne no. 21 du <code>hello.html</code>. Mais la fonction <code>require()</code> aurait d√ª √™tre l√† puisqu&rsquo;elle est fournie par les API Node.js. D&rsquo;une mani√®re ou d&rsquo;une autre, le JavaScript ex√©cut√© dans le processus de rendu n&rsquo;a pas acc√®s aux API Node.js. C&rsquo;est parce que nous n&rsquo;avons pas activ√© l&rsquo;int√©gration node ni d√©sactiv√© l&rsquo;isolation de context lors de la cr√©ation de la fen√™tre.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">openWindow</span> <span style="color:#f92672">=</span> ( <span style="color:#a6e22e">type</span> ) =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">win</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">BrowserWindow</span>( {
        <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">400</span>,
        <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">300</span>,
        <span style="color:#a6e22e">webPreferences</span><span style="color:#f92672">:</span> {
            <span style="color:#a6e22e">nodeIntegration</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#75715e">//ici
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">contextIsolation</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> <span style="color:#75715e">//et l√†
</span><span style="color:#75715e"></span>        },
    } );
    <span style="color:#75715e">//...
</span><span style="color:#75715e"></span>}
</code></pre></div><p>Maintenant vous ne devriez plus avoir d&rsquo;erreur en console (mais nous y reviendrons). Voyons √† quoi ressemble le fichier <code>image.html</code> avant de cliquer sur le bouton et de cr√©er un d√©sordre.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;fr&#39;</span>&gt;
    &lt;<span style="color:#f92672">head</span>&gt;
        &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;UTF-8&#39;</span>&gt;
        &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;viewport&#39;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;width=device-width, initial-scale=1.0&#39;</span>&gt;
        &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">http-equiv</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Content-Security-Policy&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;script-src &#39;self&#39; &#39;unsafe-inline&#39;;&#34;</span> /&gt;
        &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css&#34;</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span>&gt;
        &lt;<span style="color:#f92672">title</span>&gt;Image au hasard&lt;/<span style="color:#f92672">title</span>&gt;

        &lt;<span style="color:#f92672">style</span>&gt;
            <span style="color:#f92672">body</span> {
                <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">0</span>;
                <span style="color:#66d9ef">background-color</span>: <span style="color:#ae81ff">#eee</span>;
                <span style="color:#66d9ef">font-family</span>: <span style="color:#66d9ef">sans-serif</span>;
                <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">center</span>;
                <span style="color:#66d9ef">vertical-align</span>: <span style="color:#66d9ef">middle</span>;
                <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0</span>;
                <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
            }
        &lt;/<span style="color:#f92672">style</span>&gt;
    &lt;/<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">body</span>&gt;
        <span style="color:#75715e">&lt;!-- random image --&gt;</span>
        &lt;<span style="color:#f92672">h3</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;loading&#39;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;font-size: 14px;&#34;</span>&gt;Chargement...&lt;/<span style="color:#f92672">h3</span>&gt;
        &lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;img&#39;</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;display: none;&#34;</span>&gt;

        &lt;<span style="color:#f92672">script</span>&gt;
            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">path</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>( <span style="color:#e6db74">&#39;path&#39;</span> );
            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">axios</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>( <span style="color:#e6db74">&#39;axios&#39;</span> );
            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sharp</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>( <span style="color:#e6db74">&#39;sharp&#39;</span> );

            <span style="color:#75715e">// r√©cup√©ration d&#39;une image
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">axios</span>.<span style="color:#a6e22e">get</span>( <span style="color:#e6db74">&#39;https://source.unsplash.com/random&#39;</span>, {
                <span style="color:#a6e22e">responseType</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;arraybuffer&#39;</span>,
            } )
            .<span style="color:#a6e22e">then</span>( ( <span style="color:#a6e22e">response</span> ) =&gt; {

                <span style="color:#75715e">// creation d&#39;on objet Buffer
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">buffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Buffer</span>.<span style="color:#a6e22e">from</span>( <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">data</span>, <span style="color:#e6db74">&#39;binary&#39;</span> );

                <span style="color:#75715e">// on d√©clare le chemin pour la sauvegarde de l&#39;image
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">outPath</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">resolve</span>( <span style="color:#a6e22e">__dirname</span>, <span style="color:#e6db74">&#39;img.jpeg&#39;</span> );

                <span style="color:#75715e">// redimensionnement image avec sharp
</span><span style="color:#75715e"></span>                <span style="color:#a6e22e">sharp</span>( <span style="color:#a6e22e">buffer</span> )
                .<span style="color:#a6e22e">resize</span>( <span style="color:#ae81ff">600</span>, <span style="color:#ae81ff">300</span> )
                .<span style="color:#a6e22e">toFile</span>( <span style="color:#a6e22e">outPath</span> ) <span style="color:#75715e">// on sauve l&#39;image
</span><span style="color:#75715e"></span>                .<span style="color:#a6e22e">then</span>( () =&gt; {

                    <span style="color:#75715e">// affichage de l&#39;image dans le tag `img`
</span><span style="color:#75715e"></span>                    document.<span style="color:#a6e22e">getElementById</span>( <span style="color:#e6db74">&#39;img&#39;</span> ).<span style="color:#a6e22e">setAttribute</span>( <span style="color:#e6db74">&#39;src&#39;</span>, <span style="color:#e6db74">`file://</span><span style="color:#e6db74">${</span> <span style="color:#a6e22e">outPath</span> <span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> );
                    document.<span style="color:#a6e22e">getElementById</span>( <span style="color:#e6db74">&#39;img&#39;</span> ).<span style="color:#a6e22e">setAttribute</span>( <span style="color:#e6db74">&#39;style&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span> );
                    document.<span style="color:#a6e22e">getElementById</span>( <span style="color:#e6db74">&#39;loading&#39;</span> ).<span style="color:#a6e22e">setAttribute</span>( <span style="color:#e6db74">&#39;style&#39;</span>, <span style="color:#e6db74">&#39;display:none;&#39;</span> );
                } );
            } );
        &lt;/<span style="color:#f92672">script</span>&gt;
    &lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><p>Dans <code>image.html</code>, nous r√©cup√©rons une image al√©atoire (jpeg) √† partir de l&rsquo;URL <code>https://source.unsplash.com/random</code> √† l&rsquo;aide du package <code>axios</code>. Ensuite, nous convertissons cette image en un objet Buffer. L&rsquo;interface Buffer est fournie par Node.js. Ensuite, nous redimensionnons cette image en utilisant un package <code>sharp</code>. Nous devons donc installer ces packages.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">npm install --save axios sharp
</code></pre></div><p>Comme la variable <code>__dirname</code> fournie par Node.js pointe vers le chemin absolu de <code>image.html</code> sur le syst√®me de fichiers, c&rsquo;est pourquoi le chemin outPath est le <code>&lt;project-path&gt;/img.jpeg</code>. Lorsque nous enregistrons cette image en utilisant <code>.toFile(outPath)</code>, elle est enregistr√©e dans le r√©pertoire du projet.</p>
<p>Le protocole <code>file://</code> est utilis√© pour charger un fichier √† partir du syst√®me de fichiers local. L&rsquo;URL de l&rsquo;attribut src est <code>file:// &lt;chemin-absolu-vers-img&gt;.jpeg</code>, ce qui signifie que l&rsquo;√©l√©ment <code>&lt;img/&gt;</code> affichera le fichier r√©cemment enregistr√©. Ainsi, lorsque nous cliquons sur le bouton <strong>Cliquez pour voir une image</strong>, une nouvelle fen√™tre s&rsquo;ouvrira et rendra le fichier t√©l√©charg√©. Vous devriez √©galement voir appara√Ætre le fichier <code>img.jpeg</code> dans le r√©pertoire du projet.</p>
<p><img src="/img/electron/image.png" alt="image"></p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/javascript/" rel="tag">javascript</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/electron/" rel="tag">electron</a></li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Germain SIPIERE avatar" src="/img/moi.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name"></span>
	</div>
	<div class="authorbox__description">
		Germain SIPIERE, formateur en conception et d√©veloppement d&#39;applications √† l&#39;AFPA. J&#39;utilise diff√©rentes technologies et j&#39;adore en d√©couvrir continuellement de nouvelles
	</div>
</div>

<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/post/cours/flutter/dart1/" rel="prev"><span class="post-nav__caption">¬´&thinsp;Pr√©c√©dent</span><p class="post-nav__post-title">Flutter et Dart</p></a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 Germain SIPIERE.
			<span class="footer__copyright-credits">Produit par <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> et le th√®me <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a>.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="/js/custom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>