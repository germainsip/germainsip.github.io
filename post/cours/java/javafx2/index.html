<!DOCTYPE html>
<html class="no-js" lang="fr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>JavaFX et sauvegarde Partie 2 - Mes ressources</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="2eme Didacticiel sur la persistance">
	<meta property="og:title" content="JavaFX et sauvegarde Partie 2" />
<meta property="og:description" content="2eme Didacticiel sur la persistance" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/cours/java/javafx2/" />
<meta property="article:published_time" content="2020-03-19T10:32:50+00:00" />
<meta property="article:modified_time" content="2020-03-19T10:32:50+00:00" />

	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="JavaFX et sauvegarde Partie 2"/>
<meta name="twitter:description" content="2eme Didacticiel sur la persistance"/>

	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Mes ressources" rel="home">
				<div class="logo__title">Mes ressources</div>
				<div class="logo__tagline">Site de partage de ressources</div>
			</a>
		</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">JavaFX et sauvegarde Partie 2</h1>
			<p class="post__lead">2eme Didacticiel sur la persistance</p>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2020-03-19T10:32:50Z">19-03-2020</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/categories/javafx/" rel="category">JavaFX</a>, <a class="meta__link" href="/categories/persistance/" rel="category">Persistance</a>
	</span>
</div></div>
		</header>
		<figure class="post__thumbnail">
			<img src="/img/jfxjsonhead.png" alt="JavaFX et sauvegarde Partie 2">
		</figure>
<div class="post__toc toc">
	<div class="toc__title">Sommaire</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#importons-jsonsimple">Importons Json.simple</a></li>
    <li><a href="#mise-en-place">Mise en place</a></li>
    <li><a href="#utilisation-de-jsonsimple">Utilisation de JSON.simple</a></li>
    <li><a href="#modification-de-app-pour-afficher-la-fen√™tre-de-sauvegarde">Modification de App pour afficher la fen√™tre de sauvegarde</a></li>
    <li><a href="#√©criture-du-json-dans-un-fichier">√âcriture du Json dans un fichier</a></li>
    <li><a href="#testons-tout-√ßa">Testons tout √ßa</a></li>
  </ul>
</nav>
	</div>
</div>
<div class="content post__content clearfix">
			<p>üé• <strong>La vid√©o arrive! Juste le temps de la faire</strong> üé•</p>
<blockquote>
<p>maj: 21/03/2020</p>
</blockquote>
<p><strong>Pr√©requis:</strong> avoir suivi la premi√®re partie <a href="https://germainsip.github.io/post/cours/javafx/">JavaFX et sauvegarde Partie 1</a></p>
<p>Comme promis, nous allons d&rsquo;abord utiliser JSON.simple. Le but ici est uniquement de vous montrer comment sauvegarder quelques information sur notre application, dans la prochaine partie nous les importerons.</p>
<h2 id="importons-jsonsimple">Importons Json.simple</h2>
<p>Il faut tout d&rsquo;abord importer la biblioth√®que. Dans le pom fait un ajout de d√©pendance, soit avec clique droit sur <code>&lt;dependencies&gt;</code> et Generate&hellip; ou avec le raccourcit clavier puis Depedency.
Vous choisirez json.simple.</p>
<p>Dans le <code>pom.xml</code> √ßa nous ajoute</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>com.googlecode.json-simple<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>json-simple<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>1.1.1<span style="color:#f92672">&lt;/version&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><h2 id="mise-en-place">Mise en place</h2>
<p>Dans notre contr√¥leur nous avons d√©j√† une m√©thode <code>sauvHandler()</code> que nous allons utiliser pour la sauvegarde.
Je vais sauvegarder b√™tement les noms des champs et le label de titre.</p>
<p>Commencez par nommer les label:</p>
<ul>
<li>le label nom: <code>champNom</code></li>
<li>le label prenom: <code>champPrenom</code></li>
<li>le label titre: <code>champTitre</code></li>
<li>le label √¢ge: <code>champAge</code></li>
</ul>
<p>et d√©clarez les dans le <strong>contr√¥leur</strong></p>
<p><img src="/img/JavaFX_Json/jfxjson3.png" alt="champs"></p>
<h2 id="utilisation-de-jsonsimple">Utilisation de JSON.simple</h2>
<p>Dans la m√©thode, cr√©ons notre objet json:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#a6e22e">@FXML</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sauvHandler</span><span style="color:#f92672">(</span>ActionEvent event<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        JSONObject sauvegarde <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JSONObject<span style="color:#f92672">();</span>
        sauvegarde<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;titre&#34;</span><span style="color:#f92672">,</span> champTitre<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">());</span>
        sauvegarde<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;champNom&#34;</span><span style="color:#f92672">,</span>champNom<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">());</span>
        sauvegarde<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;champPrenom&#34;</span><span style="color:#f92672">,</span>champPrenom<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">());</span>
        sauvegarde<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;champAge&#34;</span><span style="color:#f92672">,</span>champAge<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
</code></pre></div><h2 id="modification-de-app-pour-afficher-la-fen√™tre-de-sauvegarde">Modification de App pour afficher la fen√™tre de sauvegarde</h2>
<p>Afin d&rsquo;afficher un <strong>popup de sauvegarde</strong> nous devons rendre accessible le stage √† partir du contr√¥leur.</p>
<p>Faites la modification suivante dans <code>App.java</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        launch<span style="color:#f92672">(</span>args<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// D√©claration du stage
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Stage stage<span style="color:#f92672">;</span>
    <span style="color:#75715e">// getter qui rend accessible notre stage
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Stage <span style="color:#a6e22e">getStage</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> stage<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">start</span><span style="color:#f92672">(</span>Stage primaryStage<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// R√©cup√©ration du stage
</span><span style="color:#75715e"></span>        App<span style="color:#f92672">.</span><span style="color:#a6e22e">stage</span> <span style="color:#f92672">=</span> primaryStage<span style="color:#f92672">;</span>
</code></pre></div><h2 id="√©criture-du-json-dans-un-fichier">√âcriture du Json dans un fichier</h2>
<p>Nous allons maintenant laisser l&rsquo;utilisateur dire o√π il va faire sa sauvegarde.
Utilisons <code>FileChooser</code> et sa fen√™tre popup √† la suite dans notre m√©thode <code>sauvHandler</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// D√©claration du FileChoser
</span><span style="color:#75715e"></span>FileChooser fileChooser <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileChooser<span style="color:#f92672">();</span>
<span style="color:#75715e">// Ajout d&#39;un filtre d&#39;extention
</span><span style="color:#75715e"></span>FileChooser<span style="color:#f92672">.</span><span style="color:#a6e22e">ExtensionFilter</span> extensionFilter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileChooser<span style="color:#f92672">.</span><span style="color:#a6e22e">ExtensionFilter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Json file (*.json&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;*.json&#34;</span><span style="color:#f92672">);</span>
fileChooser<span style="color:#f92672">.</span><span style="color:#a6e22e">getExtensionFilters</span><span style="color:#f92672">().</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>extensionFilter<span style="color:#f92672">);</span>

Affichage du popup
File file <span style="color:#f92672">=</span> fileChooser<span style="color:#f92672">.</span><span style="color:#a6e22e">showSaveDialog</span><span style="color:#f92672">(</span>App<span style="color:#f92672">.</span><span style="color:#a6e22e">getStage</span><span style="color:#f92672">());</span>
</code></pre></div><p>Si le fichier est bien choisi ou nomm√© par l&rsquo;utilisateur nous l&rsquo;√©crivons grace √† un <code>FileWriter</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>file <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">//Si l&#39;extension n&#39;est pas bien renseign√©e on l&#39;ajoute
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>file<span style="color:#f92672">.</span><span style="color:#a6e22e">getPath</span><span style="color:#f92672">().</span><span style="color:#a6e22e">endsWith</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;.json&#34;</span><span style="color:#f92672">))</span> file <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>file<span style="color:#f92672">.</span><span style="color:#a6e22e">getPath</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.json&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">//On √©crit le fichier avec un try..catch en cas d&#39;erreur
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">(</span>FileWriter fichier <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileWriter<span style="color:#f92672">(</span>file<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        fichier<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>sauvegarde<span style="color:#f92672">.</span><span style="color:#a6e22e">toJSONString</span><span style="color:#f92672">());</span>
        fichier<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">){</span>
          <span style="color:#75715e">//On affiche l&#39;erreur en console
</span><span style="color:#75715e"></span>          System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="testons-tout-√ßa">Testons tout √ßa</h2>
<p>Lancez note appli et cliquez sur sauver puis choisissez un emplacement de sauvegarde et validez.</p>
<p>Vous devriez obtenir un fichier dont le contenu est:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{<span style="color:#f92672">&#34;champPrenom&#34;</span>:<span style="color:#e6db74">&#34;Pr√©nom&#34;</span>,<span style="color:#f92672">&#34;titre&#34;</span>:<span style="color:#e6db74">&#34;Mon appli d&#39;Exemple&#34;</span>,<span style="color:#f92672">&#34;champAge&#34;</span>:<span style="color:#e6db74">&#34;√¢ge&#34;</span>,<span style="color:#f92672">&#34;champNom&#34;</span>:<span style="color:#e6db74">&#34;Nom&#34;</span>}
</code></pre></div><p>Voil√† nous savons sauver des donn√©es.</p>
<p>Dans la prochaine partie nous verrons comment les charger.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/javafx/" rel="tag">JavaFX</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/json/" rel="tag">Json</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/jackson/" rel="tag">Jackson</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/json.simple/" rel="tag">JSON.simple</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/flux-de-fichier/" rel="tag">flux de fichier</a></li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Germain SIPIERE avatar" src="/img/moi.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">√Ä propos Germain SIPIERE</span>
	</div>
	<div class="authorbox__description">
		Germain SIPIERE, formateur en conception et d√©veloppement d&#39;applications √† l&#39;AFPA. J&#39;utilise diff√©rentes technologies et j&#39;adore en d√©couvrir continuellement de nouvelles
	</div>
</div>

<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/post/cours/android/instal_androidstudio/" rel="prev"><span class="post-nav__caption">¬´&thinsp;Pr√©c√©dent</span><p class="post-nav__post-title">Installation d&#39;Android Studio</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/post/cours/android/android1/" rel="next"><span class="post-nav__caption">Suivant&thinsp;¬ª</span><p class="post-nav__post-title">Notre premi√®re appli Android</p></a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 Germain SIPIERE.
			<span class="footer__copyright-credits">Produit par <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> et le th√®me <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a>.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="/js/custom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>