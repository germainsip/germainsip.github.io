<!DOCTYPE html>
<html class="no-js" lang="fr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Une simple Api en PHP - Mes ressources</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="Création d&#39;API en php">
	<meta property="og:title" content="Une simple Api en PHP" />
<meta property="og:description" content="Création d&#39;API en php" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/cours/php/api/" />
<meta property="article:published_time" content="2020-04-09T09:29:38+00:00" />
<meta property="article:modified_time" content="2020-04-09T09:29:38+00:00" />

	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Une simple Api en PHP"/>
<meta name="twitter:description" content="Création d&#39;API en php"/>

	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Mes ressources" rel="home">
				<div class="logo__title">Mes ressources</div>
				<div class="logo__tagline">Site de partage de ressources</div>
			</a>
		</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Une simple Api en PHP</h1>
			<p class="post__lead">Créons notre API en PHP (pas terminé pour le moment)</p>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2020-04-09T09:29:38Z">09-04-2020</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/categories/api/" rel="category">API</a>
	</span>
</div></div>
		</header>
		<figure class="post__thumbnail">
			<img src="/img/api_php.png" alt="Une simple Api en PHP">
		</figure>
<div class="post__toc toc">
	<div class="toc__title">Sommaire</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#ça-sert-à-quoi-une-api">Ça sert à quoi une API?</a></li>
    <li><a href="#quallons-nous-faire-ici">Qu&rsquo;allons nous faire ici?</a></li>
    <li><a href="#les-prérequis-et-environnement-de-développement">Les prérequis et environnement de développement</a></li>
    <li><a href="#cest-partie">C&rsquo;est partie</a></li>
    <li><a href="#connectons-nous-à-la-base-donnée-partie-2">Connectons nous à la base donnée (Partie 2)</a></li>
    <li><a href="#accédons-à-nos-produits">Accédons à nos produits</a></li>
  </ul>
</nav>
	</div>
</div>
<div class="content post__content clearfix">
			
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/bdx9MwiD76M" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<hr>
<p>✋ en cours de rédaction ✋</p>
<hr>
<h2 id="ça-sert-à-quoi-une-api">Ça sert à quoi une API?</h2>
<p>Tout d&rsquo;abord API c&rsquo;est &ldquo;Application Programming Interface&rdquo;. En d&rsquo;autre termes c&rsquo;est une interface qui permet le transfert de données d&rsquo;une application à une (des) autre(s).</p>
<p>C&rsquo;est une technique importante puisque nous avons besoin de faire interagir nos sites web avec nos applications desktop et nos application mobiles.</p>
<p>Par exemple, on peut intégrer les données d&rsquo;une entreprise dans notre base de donnée grace à l&rsquo;API de l&rsquo;INSEE &ldquo;sirene&rdquo;. Je pense vous écrire un support pour faire ça avec Java.</p>
<h2 id="quallons-nous-faire-ici">Qu&rsquo;allons nous faire ici?</h2>
<p>Nous allons construire une API (interface sans GUI) pour faire du CRUD à partir d&rsquo;une autre application.</p>
<h2 id="les-prérequis-et-environnement-de-développement">Les prérequis et environnement de développement</h2>
<ul>
<li>Je vais utiliser un simple éditeur de texte (vscode) avec coloration syntaxique php et un plugin pour écrire en php (intelliphense par exemple)</li>
<li>Un serveur apache avec php sur votre machine (WAMP, MAMP, XAMP, LAMP, Laragon, apache2&hellip; au choix).</li>
<li>Une base de donnée Maria ou Mysql.</li>
<li>Un logiciel pour vérifier que notre API fonctionne (postman ou autre)</li>
</ul>
<h2 id="cest-partie">C&rsquo;est partie</h2>
<p>On va commencer par créer une base une base de donnée.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> api_db;

USE api_db;
</code></pre></div><p>Créer la table <code>categories</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#f92672">`</span>categories<span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT,
  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">256</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>description<span style="color:#f92672">`</span> text <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>created<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>modified<span style="color:#f92672">`</span> <span style="color:#66d9ef">timestamp</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span>,
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB  <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 AUTO_INCREMENT<span style="color:#f92672">=</span><span style="color:#ae81ff">19</span> ;
</code></pre></div><p>L&rsquo;alimenter</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#f92672">`</span>categories<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>description<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>created<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>modified<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>
(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;Mode&#39;</span>, <span style="color:#e6db74">&#39;Catégorie pour tout ce qui touche à la mode.&#39;</span>, <span style="color:#e6db74">&#39;2019-06-01 00:35:07&#39;</span>, <span style="color:#e6db74">&#39;2019-05-30 17:34:33&#39;</span>),
(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;Electronics&#39;</span>, <span style="color:#e6db74">&#39;Gadgets, drones et plus.&#39;</span>, <span style="color:#e6db74">&#39;2019-06-01 00:35:07&#39;</span>, <span style="color:#e6db74">&#39;2019-05-30 17:34:33&#39;</span>),
(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;Motors&#39;</span>, <span style="color:#e6db74">&#39;Sports motorisés et plus&#39;</span>, <span style="color:#e6db74">&#39;2019-06-01 00:35:07&#39;</span>, <span style="color:#e6db74">&#39;2019-05-30 17:34:54&#39;</span>),
(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#39;Movies&#39;</span>, <span style="color:#e6db74">&#39;Produits cinématographiques.&#39;</span>, <span style="color:#e6db74">&#39;2019-01-08 13:27:26&#39;</span>, <span style="color:#e6db74">&#39;2019-01-08 13:27:26&#39;</span>),
(<span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#39;Books&#39;</span>, <span style="color:#e6db74">&#39;Livres Kindle, livres audio et plus encore.&#39;</span>, <span style="color:#e6db74">&#39;2019-01-08 13:27:47&#39;</span>, <span style="color:#e6db74">&#39;2019-01-08 13:27:47&#39;</span>),
(<span style="color:#ae81ff">13</span>, <span style="color:#e6db74">&#39;Sports&#39;</span>, <span style="color:#e6db74">&#34;Si si le code c&#39;est du sport&#34;</span>, <span style="color:#e6db74">&#39;2019-01-09 02:24:24&#39;</span>, <span style="color:#e6db74">&#39;2019-01-09 01:24:24&#39;</span>);
</code></pre></div><p>Créer la table <code>products</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#f92672">`</span>products<span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT,
  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>description<span style="color:#f92672">`</span> text <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>price<span style="color:#f92672">`</span> decimal(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>category_id<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>created<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>modified<span style="color:#f92672">`</span> <span style="color:#66d9ef">timestamp</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span>,
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB  <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>latin1 AUTO_INCREMENT<span style="color:#f92672">=</span><span style="color:#ae81ff">65</span> ;
</code></pre></div><p>Et l&rsquo;alimenter</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#f92672">`</span>products<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>description<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>price<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>category_id<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>created<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>modified<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>
(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;LG P880 4X HD&#39;</span>, <span style="color:#e6db74">&#39;My first awesome phone!&#39;</span>, <span style="color:#e6db74">&#39;336&#39;</span>, <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;2014-06-01 01:12:26&#39;</span>, <span style="color:#e6db74">&#39;2014-05-31 17:12:26&#39;</span>),
(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;Google Nexus 4&#39;</span>, <span style="color:#e6db74">&#39;The most awesome phone of 2013!&#39;</span>, <span style="color:#e6db74">&#39;299&#39;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;2014-06-01 01:12:26&#39;</span>, <span style="color:#e6db74">&#39;2014-05-31 17:12:26&#39;</span>),
(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;Samsung Galaxy S4&#39;</span>, <span style="color:#e6db74">&#39;How about no?&#39;</span>, <span style="color:#e6db74">&#39;600&#39;</span>, <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;2014-06-01 01:12:26&#39;</span>, <span style="color:#e6db74">&#39;2014-05-31 17:12:26&#39;</span>),
(<span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#39;Bench Shirt&#39;</span>, <span style="color:#e6db74">&#39;The best shirt!&#39;</span>, <span style="color:#e6db74">&#39;29&#39;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;2014-06-01 01:12:26&#39;</span>, <span style="color:#e6db74">&#39;2014-05-31 02:12:21&#39;</span>),
(<span style="color:#ae81ff">7</span>, <span style="color:#e6db74">&#39;Lenovo Laptop&#39;</span>, <span style="color:#e6db74">&#39;My business partner.&#39;</span>, <span style="color:#e6db74">&#39;399&#39;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;2014-06-01 01:13:45&#39;</span>, <span style="color:#e6db74">&#39;2014-05-31 02:13:39&#39;</span>),
(<span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#39;Samsung Galaxy Tab 10.1&#39;</span>, <span style="color:#e6db74">&#39;Good tablet.&#39;</span>, <span style="color:#e6db74">&#39;259&#39;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;2014-06-01 01:14:13&#39;</span>, <span style="color:#e6db74">&#39;2014-05-31 02:14:08&#39;</span>),
(<span style="color:#ae81ff">9</span>, <span style="color:#e6db74">&#39;Spalding Watch&#39;</span>, <span style="color:#e6db74">&#39;My sports watch.&#39;</span>, <span style="color:#e6db74">&#39;199&#39;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;2014-06-01 01:18:36&#39;</span>, <span style="color:#e6db74">&#39;2014-05-31 02:18:31&#39;</span>),
(<span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#39;Sony Smart Watch&#39;</span>, <span style="color:#e6db74">&#39;The coolest smart watch!&#39;</span>, <span style="color:#e6db74">&#39;300&#39;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;2014-06-06 17:10:01&#39;</span>, <span style="color:#e6db74">&#39;2014-06-05 18:09:51&#39;</span>),
(<span style="color:#ae81ff">11</span>, <span style="color:#e6db74">&#39;Huawei Y300&#39;</span>, <span style="color:#e6db74">&#39;For testing purposes.&#39;</span>, <span style="color:#e6db74">&#39;100&#39;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;2014-06-06 17:11:04&#39;</span>, <span style="color:#e6db74">&#39;2014-06-05 18:10:54&#39;</span>),
(<span style="color:#ae81ff">12</span>, <span style="color:#e6db74">&#39;Abercrombie Lake Arnold Shirt&#39;</span>, <span style="color:#e6db74">&#39;Perfect as gift!&#39;</span>, <span style="color:#e6db74">&#39;60&#39;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;2014-06-06 17:12:21&#39;</span>, <span style="color:#e6db74">&#39;2014-06-05 18:12:11&#39;</span>),
(<span style="color:#ae81ff">13</span>, <span style="color:#e6db74">&#39;Abercrombie Allen Brook Shirt&#39;</span>, <span style="color:#e6db74">&#39;Cool red shirt!&#39;</span>, <span style="color:#e6db74">&#39;70&#39;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;2014-06-06 17:12:59&#39;</span>, <span style="color:#e6db74">&#39;2014-06-05 18:12:49&#39;</span>),
(<span style="color:#ae81ff">26</span>, <span style="color:#e6db74">&#39;Another product&#39;</span>, <span style="color:#e6db74">&#39;Awesome product!&#39;</span>, <span style="color:#e6db74">&#39;555&#39;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;2014-11-22 19:07:34&#39;</span>, <span style="color:#e6db74">&#39;2014-11-21 20:07:34&#39;</span>),
(<span style="color:#ae81ff">28</span>, <span style="color:#e6db74">&#39;Wallet&#39;</span>, <span style="color:#e6db74">&#39;You can absolutely use this one!&#39;</span>, <span style="color:#e6db74">&#39;799&#39;</span>, <span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#39;2014-12-04 21:12:03&#39;</span>, <span style="color:#e6db74">&#39;2014-12-03 22:12:03&#39;</span>),
(<span style="color:#ae81ff">31</span>, <span style="color:#e6db74">&#39;Amanda Waller Shirt&#39;</span>, <span style="color:#e6db74">&#39;New awesome shirt!&#39;</span>, <span style="color:#e6db74">&#39;333&#39;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;2014-12-13 00:52:54&#39;</span>, <span style="color:#e6db74">&#39;2014-12-12 01:52:54&#39;</span>),
(<span style="color:#ae81ff">42</span>, <span style="color:#e6db74">&#39;Nike Shoes for Men&#39;</span>, <span style="color:#e6db74">&#39;Nike Shoes&#39;</span>, <span style="color:#e6db74">&#39;12999&#39;</span>, <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;2015-12-12 06:47:08&#39;</span>, <span style="color:#e6db74">&#39;2015-12-12 05:47:08&#39;</span>),
(<span style="color:#ae81ff">48</span>, <span style="color:#e6db74">&#39;Bristol Shoes&#39;</span>, <span style="color:#e6db74">&#39;Awesome shoes.&#39;</span>, <span style="color:#e6db74">&#39;999&#39;</span>, <span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#39;2016-01-08 06:36:37&#39;</span>, <span style="color:#e6db74">&#39;2016-01-08 05:36:37&#39;</span>),
(<span style="color:#ae81ff">60</span>, <span style="color:#e6db74">&#39;Rolex Watch&#39;</span>, <span style="color:#e6db74">&#39;Luxury watch.&#39;</span>, <span style="color:#e6db74">&#39;25000&#39;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;2016-01-11 15:46:02&#39;</span>, <span style="color:#e6db74">&#39;2016-01-11 14:46:02&#39;</span>);
</code></pre></div><p>Vous pouvez aussi télécharger le script de création <a href="/download/ma_base.sql">ici</a>.</p>
<h2 id="connectons-nous-à-la-base-donnée-partie-2">Connectons nous à la base donnée (Partie 2)</h2>
<p>{{ partie 2}}</p>
<p>Notre projet aura cette forme à la fin de cette partie:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">api
├── config
│   └── database.php
├── objects
│   └── product.php
└── product
    └── read.php

</code></pre></div><p>Dans le dossier <code>api</code> que vous avez créé dans le dossier de votre serveur. Créons un dossier <code>config</code>.
Puis, créons le fichier <code>database.php</code> qui va nous permettre de nous connecter.</p>
<p><strong>database.php</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP"><span style="color:#75715e">&lt;?php</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Database</span> {
   <span style="color:#75715e">// On spécifie les coordonnées de connexion
</span><span style="color:#75715e"></span>   <span style="color:#66d9ef">private</span> $host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;localhost&#34;</span>;
   <span style="color:#66d9ef">private</span> $db_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;api_db&#34;</span>;
   <span style="color:#66d9ef">private</span> $dsn ;
   <span style="color:#66d9ef">private</span> $username <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;root&#34;</span>;
   <span style="color:#66d9ef">private</span> $password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;VOTRE_MOT_DE_PASSE&#34;</span>;
   <span style="color:#66d9ef">public</span> $conn;


   <span style="color:#75715e">// connexion à la base
</span><span style="color:#75715e"></span>   <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getConnection</span>() {

       $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">conn</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
       $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">dsn</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mysql:host=&#34;</span><span style="color:#f92672">.</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">host</span><span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;;dbname=&#34;</span> <span style="color:#f92672">.</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">db_name</span>;
       <span style="color:#66d9ef">try</span>{
           $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">conn</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">PDO</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">dsn</span>, $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">username</span>, $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">password</span>);
       $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">conn</span> <span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">exec</span>(<span style="color:#e6db74">&#34;set names utf8&#34;</span>);
       } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">PDOException</span> $exception) {
           <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Conneciton error: &#34;</span> <span style="color:#f92672">.</span> $exception<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getMessage</span>();
       }
       <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">conn</span>;
   }
}
</code></pre></div><h2 id="accédons-à-nos-produits">Accédons à nos produits</h2>
<p>On va créer une classe pour nos produits:</p>
<ul>
<li>Dans le dossier <code>api</code> créez un dossier <code>objects</code> et dans ce dossier créez la classe <code>product.php</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Product</span> {

    <span style="color:#75715e">// connexion à la base
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> $conn;
    <span style="color:#66d9ef">private</span> $table_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;products&#34;</span>;

    <span style="color:#75715e">// membres de l&#39;objet
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> $id;
    <span style="color:#66d9ef">public</span> $name;
    <span style="color:#66d9ef">public</span> $description;
    <span style="color:#66d9ef">public</span> $price;
    <span style="color:#66d9ef">public</span> $categorie_id;
    <span style="color:#66d9ef">public</span> $category_name;
    <span style="color:#66d9ef">public</span> $created;

    <span style="color:#75715e">// un constructeur avec $db comme connexion à la base
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __construct($db) {
        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">conn</span> <span style="color:#f92672">=</span> $db;
    }
}
<span style="color:#75715e">?&gt;</span>
</code></pre></div><p>Il nous faut aussi un fichier pour lire nos objets:</p>
<p>Ajoutez dans le dossier <code>product</code> un fichier <code>read.php</code></p>
<p>D&rsquo;abord il nous faut les headers:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
<span style="color:#75715e">// Les headers dont nous avons besoin
</span><span style="color:#75715e"></span><span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#34;Access-Control-Allow-Origin: *&#34;</span>);
<span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#34;Content-Type: application/json; charset=UTF-8&#34;</span>);
</code></pre></div><p>On prépare la connection en incluant nos import et en instanciant nos objets:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>

<span style="color:#75715e">// ... le code qui précède dans read.php
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// inclusion de database et product
</span><span style="color:#75715e"></span><span style="color:#66d9ef">include_once</span> <span style="color:#e6db74">&#39;../config/database.php&#39;</span>;
<span style="color:#66d9ef">include_once</span> <span style="color:#e6db74">&#39;../objects/product.php&#39;</span>;

<span style="color:#75715e">// instanciation de database et de product
</span><span style="color:#75715e"></span>$database <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Database</span>();
$db <span style="color:#f92672">=</span> $database<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getConnection</span>();

<span style="color:#75715e">// On initialise product
</span><span style="color:#75715e"></span>$product <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Product</span>($db);
</code></pre></div><p>On va lire les résultats de la méthode <code>read()</code>de <code>Product</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// le query
$stmt = $product-&gt;read();
$num = $stmt-rowCount();

// on regarde si on a plus d&#39;un résultat
if($num&gt;0){

    // tableau de produits
    $products_arr = array();
    $products_arr[&#34;records&#34;]=array();

    // on récupère le contenu de la table
    while ($row = $stmt-&gt;fetch(PDO::FETCH_ASSOC)){
        extract($row);

        $product_item = array(
            &#34;id&#34; =&gt; $id,
            &#34;name&#34; =&gt; $name,
            &#34;description&#34; =&gt; $price,
            &#34;category_id&#34; =&gt; $category_id,
            &#34;category_name&#34; =&gt; $category_name
        );

        array_push($products_arr[&#34;records&#34;], $product_item);
    }

    // on envoie la réponse http à 200 OK
    http_response_code(200);

    // on renvoie la réponse en Json
    echo json_encode($products_arr);

}
</code></pre></div><p>Il nous faut maintenant ajouter la méthode <code>read()</code> à <code>Product.php</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>

<span style="color:#f92672">...</span>

<span style="color:#75715e">// lecture des produits
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">read</span>() {
  <span style="color:#75715e">// requête select avec jointure
</span><span style="color:#75715e"></span>  $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT
</span><span style="color:#e6db74">            c.name as category_name, p.id, p.name, p.description, p.price, p.category_id, p.created
</span><span style="color:#e6db74">            FROM&#34;</span>
           <span style="color:#f92672">.</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">table_name</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34; p
</span><span style="color:#e6db74">            LEFT JOIN
</span><span style="color:#e6db74">            categories c ON p.category_id = c.id
</span><span style="color:#e6db74">            ORDER BY
</span><span style="color:#e6db74">            p.created DESC&#34;</span>;

  <span style="color:#75715e">// on prépare la requête
</span><span style="color:#75715e"></span>  $stmt <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">conn</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prepare</span>($query);

  <span style="color:#75715e">// on execute la requête
</span><span style="color:#75715e"></span>  $stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">execute</span>();

  <span style="color:#66d9ef">return</span> $stmt;
}
</code></pre></div><p>Et on va avertir l&rsquo;utilisateur si aucun produit n&rsquo;a été trouvé.</p>
<p>A la suite de notre <code>if</code> dans <code>read.php</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
<span style="color:#75715e">//fin du if
</span><span style="color:#75715e"></span><span style="color:#66d9ef">else</span> {
<span style="color:#75715e">// on renvoie le code 404 Not found
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">http_response_code</span>(<span style="color:#ae81ff">404</span>);

<span style="color:#75715e">// On averti l&#39;utilisateur
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">json_encode</span>(<span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;message&#34;</span><span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Aucun produits trouvés.&#34;</span>));
}

</code></pre></div><p>Il ne vous reste qu'à tester tout ça avec Postman ou Insomnia.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/php/" rel="tag">php</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/api/" rel="tag">API</a></li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Germain SIPIERE avatar" src="/img/moi.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">À propos Germain SIPIERE</span>
	</div>
	<div class="authorbox__description">
		Germain SIPIERE, formateur en conception et développement d&#39;applications à l&#39;AFPA. J&#39;utilise différentes technologies et j&#39;adore en découvrir continuelement de nouvelles
	</div>
</div>

<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/post/cours/android/android_images/" rel="prev"><span class="post-nav__caption">«&thinsp;Précédent</span><p class="post-nav__post-title">Android et les images</p></a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 Germain SIPIERE.
			<span class="footer__copyright-credits">Produit par <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> et le thème <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a>.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="/js/custom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>